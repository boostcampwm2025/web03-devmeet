# 25/12/18

## Cards

### 1. 스키마

```sql
CREATE TABLE `Cards` (
  card_id BINARY(16) PRIMARY KEY NOT NULL,
  user_id BINARY(16) NOT NULL,
  category_id INT UNSIGNED NOT NULL,
  thumbnail_path VARCHAR(255),
  `status` ENUM('published', 'draft', 'archived') NOT NULL,
  title VARCHAR(255) NOT NULL,
  workspace_width INT UNSIGNED NOT NULL,
  workspace_height INT UNSIGNED NOT NULL,
  background_color VARCHAR(32) NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP,

  CONSTRAINT check_cards_workspace_width_workspace_height CHECK(`workspace_width` > 0 AND `workspace_height` > 0),

  CONSTRAINT check_background_color
    CHECK (
      background_color REGEXP '^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$'
      OR background_color REGEXP '^rgb\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3}\\)$'
      OR background_color REGEXP '^rgba\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(0(\\.[0-9]+)?|1(\\.0+)?)\\)$'
      OR background_color IN ('transparent', 'currentColor')
    )
);
```

### 2. 인덱싱
```sql
CREATE INDEX idx_cards_user_status_deleted_updated
  ON `Cards`(user_id, `status`, deleted_at, updated_at);

CREATE INDEX idx_cards_category_status_deleted_updated
  ON `Cards` (category_id, `status`, deleted_at, updated_at);
```

## Card_items

### 1. 스키마

```sql
CREATE TABLE `Card_items` (
  item_id BINARY(16) PRIMARY KEY NOT NULL,
  card_id BINARY(16) NOT NULL,
  `type` ENUM('text', 'image', 'video') NOT NULL,
  x INT NOT NULL,
  y INT NOT NULL,
  width INT UNSIGNED NOT NULL,
  height INT UNSIGNED,
  rotation SMALLINT NOT NULL DEFAULT 0,
  scale_x DECIMAL(6,3) NOT NULL DEFAULT 1.000,
  scale_y DECIMAL(6,3) NOT NULL DEFAULT 1.000,
  opacity DECIMAL(3,2),
  z_index INT,
  is_locked BOOLEAN,
  is_visible BOOLEAN,
  `name` VARCHAR(255),
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP,

  CONSTRAINT fk_card_card_items_card_id FOREIGN KEY (`card_id`) REFERENCES `Cards`(`card_id`) ON UPDATE CASCADE ON DELETE CASCADE,
  CONSTRAINT check_card_items_opacity CHECK(`opacity` IS NULL OR (`opacity` >= 0 AND `opacity` <= 1) )
);
```

### 2. INDEX

```sql
CREATE INDEX idx_card_items_card_id_deleted_at_z_index
  ON `Card_items`(`card_id`, `deleted_at`, `z_index`);
```

